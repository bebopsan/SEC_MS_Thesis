% this file is called up by thesis.tex
% content in this file will be fed into the main document

%------------------------------------------------------------------------- 

\chapter{Caracterización de aberraciones en Vórtices Ópticos}
\label{cha:Car_intro}
\graphicspath{{Figures/chPD_img/}{../Figures/chPD_img/}}
\lhead{Caracterización de aberraciones en Vórtices Ópticos:
  \textit{Introducción}} % This is for the header on each page -
                         % perhaps a shortened title
\section{Introducción}
En capítulos anteriores ha quedado claro que para producir VO es
necesario contar con un sistema óptico en el cual sea posible
manipular con precisión la fase de un frente de onda.  Asimismo, se
presentó un montaje experimental en el cual logramos generar VO a
partir del uso de dispositivos difractivos conocidos como SLMs. 
No obstante, los VO obtenidos distan de ser de suficiente calidad como
para ser usados en aplicaciones científicas o tecnológicas. 

Esta segunda parte de la tesis abarca el trabajo que se realizó para
mejorar la calidad óptica de nuestro montaje con el fin de mejorar los
VO que se obtuvieron en la parte anterior. 

\section{Estado del Arte}
\label{sec:ChPD_estado_del_arte}
\lhead{Caracterización de aberraciones en Vórtices Ópticos: \textit{Estado
    del Arte}}

Los sistemas ópticos formadores de imagen que se encuentran en
aplicaciones de la vida real están sujetos a aberraciones de fase que
limitan su resolución. Es por ello que en la industria y en laboratorios se hace un gran esfuerzo para
detectar aberraciones y corregirlas vía Óptica Adaptativa (AO) \citepChPD{Kubby2013} o por
medio de técnicas digitales posteriores a la adquisición
\citepChPD{Korkiakoski2012}. 

Las aberraciones ópticas en un sistema formador de imagen pueden
proceder de fuentes intrínsecas tales como imperfecciones en el
diseño, los materiales, la manufactura o la alineación de los
elementos que los componen. O de fuentes extrínsecas como variaciones
en el índice de refracción de muestras microscópicas y turbulencia atmosférica en
imágenes capturadas usando telescopios. La presencia de aberraciones
del último tipo en imágenes procedentes de telescopios terrestres, y
la dificultad de modificar los sistemas para incluir brazos de referencia han sido la motivación para
el desarrollo de varias técnicas de Sensado de Fase no
Interferométricas (NI-WFS). La técnica de Diversidad de Fases o Phase
Diversity (PD) pertenece a una familia de NI-WFS conocida como de
Reconstrucción de Fase o Phase Retrieval. A diferencia de técnicas
directas que requieren de óptica y sensores adicionales como los
sistemas que usan sensores Shack-Hartman, las técnicas de Phase
Retrieval consisten en la determinación de la fase de una función
compleja a partir de medidas de su magnitud usando 
información a priori de la función o de su transformada \citepChPD{Fienup1993}. 
Específicamente, la técnica de reconstrucción  PD ha sido usada
exitosamente en el contexto de sistemas de AO para incrementar la resolución de sistemas ópticos
tales como el Telescopio Espacial Hubble \citepChPD{Fienup1993}, y en
post procesamiento de imágenes de astronomía en las cuales la
resolución es crítica. Dos casos muy relevantes son el estudio de
manchas solares y la detección de planetas extrasolares \citepChPD{Lofdahl1994,Bonet2005,Korkiakoski2012,Sauvage2007,Sauvage2012}. 
Así como con otras técnicas desarrolladas para aplicaciones en
astronomía, los métodos de reconstrucción de fase como el
Gerchberg-Sachston (GS) y PD han migrado a aplicaciones en el
laboratorio, y más específicamente a aplicaciones en microscopía de
fase \citepChPD{Jesacher2007,Camacho2010,Kner2013a}. Tal es el caso
del trabajo de \citetChPD{Jesacher2007} que implementó una versión del
método GS para la optimización de pinzas ópticas utilizadas como
iluminación en sistemas de microscopía de contraste de fase espiral. \\
En este capítulo se presenta un método novedoso de reconstrucción de
fase del tipo PD inspirado en la aplicación antes mencionada, y por
medio del cual fue posible detectar y corregir las aberraciones ópticas
del sistema generador de VO presentado en el capítulo
\ref{cha:Gen_intro}.  A continuación, se presenta el marco teórico que
soporta la implementación del método. En la sección
\ref{sec:ChPD_materiales_y_metodos} se presenta el montaje óptico y se
describe el algoritmo general para la reconstrucción de fase. Lugo, en
la sección \ref{sec:ChPD_resultados} se presentan los resultados de
simulaciones y experimentos que permiten corroborar la efectividad del
método para la corrección de aberraciones. 

\section{Marco Teórico}
\label{sec:ChPD_marco_teorico}
Los métodos de reconstrucción de fase no interferométricos dependen de
la medida de la intensidad de la intensidad del campo óptico que se
propaga a traves de un sistema formador de imagen. Si el sistema
formador de imagen se
caracteriza por su Función de Dispersión de Punto (PSF), la intensidad
a la salida puede ser descrita como una convolución entre la imagen a
la entrada y la PSF tal y como se ilustra en la ecuación
(\ref{eq:Output_Image}).
\begin{equation}\label{eq:Output_Image}
d(\vec{x}) = d_{obj}(\vec{x}) \otimes s(\vec{x}).
\end{equation}
En este caso hemos usado la notación de \citetChPD{Paxman1992} dónde
la PSF se representa como $s$, $d_{obj}$ es la intensidad del objeto a
la entrada y $d$ es la intensidad de la imagen a la salida, todas
ellas evaluadas en el espacio de coordenadas naturales ($\vec{x}$). El
 \href{http://es.wikipedia.org/wiki/Teorema_de_convolución}{Teorema de
   Convolución} permite representar la operación de la expresión
 (\ref{eq:Output_Image}) como un simple producto punto entre las
 Transformadas de Fourier (FT) de la intensidad a la entrada y la
 PSF como se muestra a continuación. 
\begin{equation}\label{eq:Output_Image_fourier}
D(\vec{u}) = D_{obj}(\vec{u})S(\vec{u}).
\end{equation}
En \ref{eq:Output_Image_fourier} el término $S$ denota la Función de
Transferencia Óptica (OTF) del sistema formador de imagen, y así como
con los otros términos, letras mayúscula denotan una transformada de
Fourier sobre la función con notación minúscula.
\begin{align*} 
S(\vec{u})&= \mathcal{F}\{ s(\vec{x}) \},&D(\vec{u})&= \mathcal{F}\{ d(\vec{x}) \}, &D_{obj}(\vec{u})&= \mathcal{F}\{ d_{obj}(\vec{x}) \}. 
\end{align*}
Hasta el momento hemos trabajado únicamente con funciones reales que
representan la intensidad del campo punto a punto en los planos objeto
e imagen de un sistema óptico. Este tipo de notación es de gran utilidad para las
aplicaciones clásicas del método PD que hacen imagen de objetos
lejanos, y con fuentes de iluminación no coherentes. Sin embargo, en
sistemas ópticos con fuentes de iluminación coherentes, como el que se presentó en la primera parte de este documento
para la generación de VO, tenemos la ventaja de trabajar con
campos complejos que proporcionan información de amplitud y fase. Para
adaptar el método clásico de PD a una versión de iluminación coherente
es necesario trabajar con campos complejos. Es bien sabido que la OTF
y la PSF forman un par de Fourier en el dominio no coherente, y cada
una de ellas tiene un equivalente en el dominio de la luz
coherente. Por una parte, la contraparte coherente de la PSF es la
Función de Respuesta al Impulso en amplitud o PSF de amplitud y de
aquí en adelante se denotará como $h(\vec{x})$. La PSF es el módulo
cuadrado de la PSF de amplitud (APSF), 
\begin{equation}\label{eq:PSF}
s(\vec{x}) = |h(\vec{x})|^2.
\end{equation}
Y así
como la PSF relaciona intensidades de campo a la entrada y salida de
un sistema por medio de una convolución, la PSF de amplitud relaciona
los campos ópticos complejos.
 \begin{equation}\label{eq:Output_Image_complex}
u(\vec{x}) = u_{obj}(\vec{x}) \otimes h(\vec{x}).
\end{equation}
Del otro lado, el equivalente coherente de la OTF es la Función de
Transferencia Óptica de amplitud, o Pupila Generalizada del sistema
(GP) y por ser el par de Fourier de la APSF se cumple la relación (\ref{eq:GP}). 
\begin{equation}\label{eq:GP}
 H(\vec{u}) = \mathcal{F} \{h(\vec{x})\} =  A(\vec{u}) e^{i\phi(\vec{u})}
\end{equation}
En (\ref{eq:GP}) se observa que fuera de ser la FT de la APSF, la GP es
una función compleja que describe tanto la forma y
tramitancia de la apertura $A(\vec{u})$ como la fase introducida por sistema
óptico $\phi(\vec{u})$. Esta fase generalmente es sinónimo de las
aberraciones del sistema y se describe matemáticamente de forma
parametrizada como una combinación de polinomios de polinomios de Zernike.\\
La OTF de un sistema formador de imagen con iluminación coherente se
puede obtener mediante la autocorrelación normalizada de la GP como se
muestra a continuación.
\begin{equation}\label{eq:OTF}
S(\vec{u}) = \frac{H(\vec{u}) \star H(\vec{u})}{|H(\vec{u})|^2}
\end{equation}
Todo lo mencionado anteriormente ha sido ingeniosamente condensado por
\citetChPD{UribePatarroyo2011} en una versión de la figura
\ref{fig:ChPD_kernels_sistemas_formadores_de_imagen}. 
\begin{figure}[h!]
\centering
\includegraphics[scale=.8]{kernels_sistemas_formadores_de_imagen.pdf}
\caption[Relaciones entre funciones de transferencia ópticas y sus FT.]{Relaciones entre funciones de transferencia ópticas y sus
  transformadas de Fourier en los dominios coherente y no
  coherente. Inspirado en una versión similar de \citetChPD{UribePatarroyo2011}.}
\label{fig:ChPD_kernels_sistemas_formadores_de_imagen}
\end{figure} 
Ahora bien, las expresiones (\ref{eq:PSF}) y (\ref{eq:OTF}) nos
permiten llevar sistemas ópticos descritos por campos complejos a la
notación tradicional del PD. A continuación se describen los aspectos
 generales de la reconstrucción de fase con PD, en la sección
 \ref{sec:ChPD_PD_il_coherente} se describirán las modificaciones que
 hacemos al PD tradicional para aprovechar el tipo de iluminación no
 coherente, y en la sección \ref{sec:ChPD_PD_Spiral_Diversity} se
 explica el efecto de introducir máscaras espiral como diversidades de
 fase. 

\subsection{PD tradicional}
\label{sec:ChPD_PD_tradicional}
Si la GP del sistema es modificada por un cambio conocido en la fase o
diversidad de fase de la forma:
$$H_{\Delta}=e^{\phi_1(\vec{u})}.$$ 
Obtenemos una nueva GP que se puede describir como el producto entre
la GP original ($H_{0}$) y la GP con el cambio o diversidad de fase
($H_{\Delta}$). Estas diversidades son generalmente desenfoques
introducidos al cambiar el camino óptico de haces esféricos, o pueden
ser otro tipo de distribuciones de fase fácilmente parametrizables en
polinomios de Zernike como el astigmatismo. Tomando la autocorrelación normalizada de la GP con
diversidad como se muestra en la expresión (\ref{eq:first_diversity_OTF})
\begin{equation}\label{eq:first_diversity_OTF}
S_1 = \frac{H_1\star H_1}{|H_1|^2} = \frac{H_0H_{\Delta} \star H_0H_{\Delta}}{|H_0H_{\Delta}|^2}
\end{equation}
obtenemos una OTF con diversidad $\phi_1$ que nos permitirá predecir cómo son
las imagenes registradas a la salida del sistema cuando se introduce
un cambio de fase: $$D_1 = D_{obj} S_1.$$ 
La tarea de encontrar las aberraciones del sistema óptico en el PD
tradicional consiste entonces en encontrar una distribución de fase
inicial $\phi(\vec{u})$ que en combinación con la función pupila
$A(\vec{u})$ componga una OTF capaz de modelar el
sistema. Esta OTF debe predecir, a partir de una entrada dada 
($D_{obj}$)  no solo la imagen nominal ($D_0$), sino tambien
las imágenes distorsionadas $D_{1...k}$ que resultan de la adición de
$k$ diversidades de fase distintas. Y la adición de más de una
diversidad de fase es la que diferencia al método PD de métodos
similares, en particular, la inclusión de diversidades implica que la
fase del frente de onda recuperado debe ser una solución para un
conjunto de sistemas y no sólo para uno, esto le otorga al método una
mayor precisión.  La fase del frente de onda a recuperar puede ser
encontrada utilizando Algoritmos de Propagación Iterativos como el GS o por
métodos de búsqueda basados en el Gradiente \citepChPD{Fienup1993}.
Las implementaciones de PD basadas en algoritmos de búsqueda del
gradiente usan métodos de búsqueda de la mayor pendiente para
minimizar funcionales de la forma:
\begin{equation}\label{eq:metric}
L(\bar{D}_{obj}, \phi)= \sum_{j=0}^{K} \sum_{u,v}^{M,N}  \left |D_{j} - \bar{D}_{obj} S_{j} \right | ^2.
\end{equation}

Dónde $\bar{D}_{obj}$ es la FT del objeto a la entrada limitada por las frecuencia
de corte establecidas en la apertura, y $D_{j}$ es la FT de la intensidad
medida experimentalmente por una cámara en el pixel con coordenadas $(u,v)$ luego de
introducir una diversidad de fase conocida con índice $j$.      
Este funcional actua como una medida de la similitud entre la
intensidad de un objeto que se propaga por un sistema modelado por
$S_{j}$ y la medida real de su imagen. Obtener un valor mínimo al
evaluar el funcional para todas las diversidades $j$ implica que el objeto a la entrada y la OTF del
sistema se conocen de forma suficientemente precisa como para emular
el sistema real.   

Es importante fijarse en que el funcional clásico de PD
(\ref{eq:metric}) debe solucionarse simultaneamente con respecto a dos
variables. Esto se debe a que en aplicaciones de PD para sensado
remoto se desconoce tanto la fase introducida por el sistema, como las
propiedades del objeto a la entrada. Puesto que solucionar un funcional
simultaneamente para dos funciones resulta complejo y muy costoso
computacionalmente, desde los inicios de la técnica autores como \citetChPD{Gonsalves1982} han propuesto
una transformación de (\ref{eq:metric}) que permite describir el funcional sólo en términos
de la fase del frente de onda. Esta transformación está descrita
de forma muy completa y generalizada en el trabajo de \citetChPD{Paxman1992}, y ha
sido implementada exitosamente por \citetChPD{Katkovnik2012}. No
obstante, ha sido demostrado que la forma reducida del funcional es
mucho más susceptible a devolver mínimos locales en la presencia de
ruido Gaussiano, y por tanto se ha propuesto el uso de métodos de
regularización y metaheurísticos para incrementar la convergencia.  

En la siguiente sección se propone una modificación al PD clásico que
soluciona estos problemas con la condición de limitar el método a
rangos de aplicación en los cuales es posible conocer el frente de
onda a la entrada del sistema óptico. 

\subsection{PD con iluminación coherente}
\label{sec:ChPD_PD_il_coherente}

La variación de PD que nosotros proponemos puede llamarse PD con
iluminación coherente, y requiere de 
conocer el frente de onda a la entrada del sistema. En nuestro caso,
como los VO van a ser generados para aplicaciones en microscopia,
el sistema óptico es un microscopio 4F compuesto por dos lentes. 
 Dado que en el montaje que usamos para generar VO usamos una fuente laser, podemos asumir que el campo óptico a la entrada ($u_{obj}$) se puede representar
como un haz de luz coherente con perfil Gaussiano y frente de onda
plano. 
$$u_{obj} = e^{\frac{-(x^2+y^2)}{\sigma}}.$$
 Ese sería el campo óptico a la entrada del 4F, es decir, a una distancia focal de la primera lente. La FT del
 objeto ($U_{obj}$) con coordenadas de frecuencia espacial puede ser
 observada en el plano focal de la
 primera lente (2F), y el campo a la salida del sistema está de nuevo
 en coordenadas naturales y se puede observar a 4 distancias
 focales. Si se define la GP en términos de la apertura en el dominio de Fourier, y
 la fase de la GP se asocia a la fase introducida
 tanto por aberraciones del sistema como por las diversidades, el
 campo a la salida se puede expresar en términos del campo a la
 entrada como se muestra en la ecuación \ref{eq:field}.
\begin{equation}\label{eq:field}
u_{j}(\vec{x}) = \mathcal{F}^{- 1}\{ U_{obj} H_0(\vec{u}) H_j(\vec{u}) \}.
\end{equation} 
Con la expresión (\ref{eq:field}) se puede plantear un equivalente coherente del
funcional (\ref{eq:metric}) en el cual la única incógnita son las
aberraciones introducidas por el sistema óptico.
\begin{equation}
L_j(\phi)= \sum_{j=0}^{K} \sum_{u,v}^{M,N}  \left |d_{j} - |u_j|^2
\right | ^2.
\label{eq:metric_coherent}
\end{equation}
Si la apertura es circular y el objeto es un haz Gaussiano con frente
de onda plano, las distribuciones de intensidad a la salida para cada diversidad ($d_{j}$)
son patrones de Airy distorsionados 
localizados en el centro de la imagen.  
Es importante notar que a diferencia del PD tradicional, nosotros
comparamos las imágenes en coordenadas naturales en vez del dominio de
frecuencia espacial. Esto se debe a que el sistema formador de
imágenes es un 4F. Otra diferencia muy importante es que podemos saber
cómo será la fase a la salida, cosa que no se podría hacer con
iluminación no coherente. Esto es esencial si queremos garantizar un
perfil de fase específico como por ejemplo una vorticidad particular. 

\subsection{Máscaras espirales como diversidades de fase}
\label{sec:ChPD_PD_Spiral_Diversity}
Como se mencionó en la introducción, \citetChPD{ Jesacher2007}
propusieron el uso de máscaras espirales para mejorar el desempeño en
la reconstrucción de aberraciones por medio del método GS en un
sistema formador de imagen. El GS es un método iterativo de
reconstrucción de fase que funciona con sólo una imagen como
entrada. En ese trabajo mostraron que si el sistema
óptico se ilumina con haces portadores de OAM 1, la imagen a la salida
(que tiene forma de dona) responde con mucha mayor sensibilidad a aberraciones que las
imagenes observadas cuando la iluminación es de fase plana (OAM 0). Ese
incremento en la sensibilidad se ve traducido en una mayor
precisión, y en un aumento en la convergencia que hacen del método una alternativa
atractiva para la optimización de sistemas ópticos en los cuales se
necesita contról preciso de la fase. 

Los resultados de \citetChPD{ Jesacher2007} pueden ser extendidos al
método de PD con iluminación coherente si se modifica el funcional (\ref{eq:metric_coherent}) de la
sección \ref{sec:ChPD_PD_il_coherente} para recibir una nueva familia de
diversidades de fase que introduzcan OAM al haz de entrada. \\
Estas diversidades son máscaras espiral de fase parametrizadas por el
valor de su carga topológica $l$ y definidas como:

$$\psi_l = arg(\exp{(il \theta)})$$

tal y como se mostró en la sección (referenciar la sección en la que
se habla del programa para generación de máscaras). 

Al incluir las máscaras espiral en un plano de Fourier del sistema, la fase del frente de
onda se puede representar aproximadamente suma de:
\begin{itemize}
\item Las aberraciones inherentes al sistema ($\phi$) representadas como una
  combinación ponderada de polinomios de Zernike. En nuestro caso la
  combinación se hace con los primeros 15 coeficientes siguiendo la
  convención de numeración de \citetChPD{Noll1976}. 
\item La diversidad de fase espiral ($\psi_l$).
\item La diversidad de fase de aberración ($\psi_l$) que consiste en
  un solo elemento de la base de Zernike, como desenfoque o
  astigmatismo. 
\end{itemize}
El campo complejo a la salida del sistema cuando se introduce una diversidad de
aberración $j$ y una diversidad de espiral de fase $l$ en un plano de
Fourier es entonces:
\begin{equation}\label{eq:newGP}
 u_j^l =  \mathcal{F}^{- 1}\{U_{obj} A e^{i\left(
     \phi+ \psi_l + \phi_j \right)} \}.
\end{equation}

Usando la ecuación (\ref{eq:newGP}) se puede definir el funcional de
PD coherente mejorado con VO que se muestra en la ecuación
(\ref{eq:metric_coherent_OAMs}). %a continuación:
\begin{equation}\label{eq:metric_coherent_OAMs}
L(\phi)= \sum_{l=0}^L\sum_{j=0}^{K} \sum_{u,v}^{M,N}  \left |d_{j}^l - |u_j^l|^2 \right | ^2.
\end{equation}

Con ese funcional se puede plantear una metodología de solución para
el problema de reconstrucción de fase como se ilustra en el diagrama
de flujo de la figura  \ref{fig:flowchart}.

\begin{figure}[h!]
\centering
\includegraphics[scale=1.2]{PDLightFlux_simple_esp.pdf}
\caption[Diagrama de flujo del PD con iluminación coherente]{Diagrama de flujo de una implementación de PD con iluminación
  coherente mejorado con VO.}
\label{fig:flowchart}
\end{figure}

A continuación, en lo que resta de este capitulo se ahondará en el método y en los detalles del proceso
para entender qué es lo que sucede en cada una de las etapas. 

\section{Materiales y Métodos}
\label{sec:ChPD_materiales_y_metodos}

Como se mencionó en la sección \ref{sec:ChPD_PD_il_coherente}, para
poder generar imágenes simuladas $|u_j^l|^2$ nuestro método se basa en
la premisa de conocer el campo óptico a la entrada del sistema
formador de imagen. Es decir que si usamos un láser de buena calidad
para obtener las imágenes del brazo izquierdo del diagrama
\ref{fig:flowchart} podemos asumir que el campo a la entrada del
sistema simulado ($u_{obj}$)
%que produce las imágenes del brazo derecho
, tiene las características
ópticas de una fuente láser coherente, es decir: amplitud Gaussiana, perfil
de fase plano, y que además está limitado por una
apertura circular correspondiente a la geometría de las lentes (En esta parte se podría hacer referencia a
un montaje óptico descrito en el capítulo pasado. Idealmente a una fotografía).  

Como el nuestro es un sistema formador de imagen y vamos a introducir las
máscaras de diversidades en un plano de Fourier para simular la autocorrelación, se debe obtener la
transformada de Fourier del campo mencionado anteriormente y colimar
el haz para evitar que siga divergiendo. En adelante haremos
referencia a la figura \ref{fig:set-up} para ilustrar las diferentes
partes del sistema para reconstrucción de fase como si se tratara de
un sistema 4F.
Suponiendo que el frente de onda ya ha sido transformado al dominio de Fourier y que se
encuentra colimado, representamos en el extremo izquierdo de la figura
\ref{fig:set-up} la FT del campo a la entrada ($U_{obj}$) como un haz
circular que incide sobre un TN-SLM (El mismo Holoeye 2002 que se
present[o anteriormente).  Dado que el campo ha sido
colimado luego de obtener su FT, se puede asumir que todos los planos desde que
se colima el haz hasta que vuelve a pasar por una lente son
equivalentes al plano de Fourier de un sistema 4F, y eso nos brinda un
espacio adecuado para introducir el SLM como se muestra en el recuadro
azul de la figura \ref{fig:set-up}. 

Si se trabaja en aplicaciones de microscopía en las cuales los objetos
son de tamaños micrométricos, sus transformadas de Fourier son campos
ópticos más extensos y la información en coordenadas de frecuencia
espacial puede dispersarse en tamaños comparativamente más
grandes. Una ventaja significativa de modificar el PD para que las
diversidades de fase se introduzcan en un plano de Fourier es el hecho
de que se pueden aprovechar más pixeles, y por ende se aumenta la
resolución espacial de la modulación de fase. 

%El uso de SLMS y sus ventajas. 

El uso de dispositivos de modulación espacial de la fase para
aplicaciones en PD se ha extendido en la literatura
\citepChPD{Uribe-Patarroyo2010,Camacho2010,Korkiakoski2012,Katkovnik2012}
debido a la flexibilidad con la que se pueden generar máscaras de fase
arbitrarias como diversidades de fase, a diferencia de métodos
tradicionales como desenfoques que dependen de desplazamientos y alineación muy
precisos de elementos ópticos. Más aún, el uso de elementos de
la base de Zernike (diferentes al desenfoque) como diversidad de aberración tiene la ventaja de
producir distorsiones más grandes y más facilmente detectables en la
distribución de intensidad del plano imagen. Esto es particularmente
cierto cuando los las distribuciones pertenecen a objetos altamente
sensibles a aberraciones como es el caso de los OV. Polinomios de
Zernike como los dos correspondientes al astigmatismo primario han
sido usados por \citetChPD{Kner2013} como diversidad de aberración en PD para reconstrucción de
fase de objetos tridimensionales en aplicaciones de microscopía donde
el desenfoque no añade una cantidad significante de información. 
 
\begin{figure}[h!]
\centering
\includegraphics[scale=.5]{PhaseDiversitySetup_esp.pdf}
\caption[Diagrama del sistema óptico para PD con iluminación coherente.]{Un SLM es usado para introducir diversidades de fase en un
  plano de Fourier. La máscara que se asigna al CL es una combinación de:
  (a) Máscara espiral de fase con OAM 1, (b) rejilla de difracción
  tipo Blazed, y (c) +0.5 astigmatismo primario como diversidad de
  aberración. El primer orden de difracción producido por la rejilla
  es usado como portador de los haces Laguerre-Gauss con OAM1
  enfocados en el plano imagen.} 
\label{fig:set-up}
\end{figure}

Cuando $U_{obj}$ llega al SLM se encuentra con una combinación de tres
máscaras de fase que han sido asignadas a los píxeles del CL. La
primera de estas máscaras, visible en la figura \ref{fig:set-up}(a)  es una máscara de espiral de fase con carga
topologica $l$ que (como
se vio en la sección ``referenciar sección'') introduce un una
singularidad de fase de orden $l$ al campo. La segunda máscara
(\ref{fig:set-up}(b)) corresponde a una rejilla de difracción del tipo
blazed que se usa para separar la luz que ha sido difractada al primer
orden del resto. Esta rejilla mejora de forma significativa la calidad
de los vórtices ópticos porque evita efectos de interferencia causados
por partes del campo que no son correctamente difractadas por el
modulador. La poca eficiencia de difracción se debe a la no linealidad
de la modulación y al hecho de que los TN-SLM de transmisión no logran
modulaciones de $2\pi$.  Finalmente, la tercera máscara
(Fig. \ref{fig:set-up}(c)) introduce la diversidad de fase de
aberración, en este caso, y en adelante corresponde al polinomio de
Zernike de astigmatismo primario (De índice 4 en la notación de
Noll). La suma de las tres máscaras tal y como se le presenta al SLM
en el montaje experimental se muestra en la figura
\ref{{fig:mixed_mask}} superpuesta a una
apertura circular que corresponde al tamaño del haz en el SLM.   

\begin{figure}[h!]
\centering
\includegraphics[scale=.5]{mixed_mask.pdf}
\caption[Ejemplo de una máscara tenedor con astigmatismo.]{Ejemplo de una máscara tenedor que resulta de combinar una
  máscara de espiral con $l=1$, con una red de difracción y una
  máscara de diversidad de aberración con astigmatismo primario de
  $Z_4=0.5\lambda$.} 
\label{fig:mixed_mask}
\end{figure}

Luego de atravesar el SLM el haz encuentra el resto del sistema óptico
y se enfoca para formar imagen ($|u_j^l|^2$) en el plano de observación o plano
imagen. 
% En nuestro caso el resto del sistema consiste en una sola
% lente (tal y como se muestra en alguna foto) con la misma curvatura
% que la lente usada para colimar el haz hace ima. 
Como se puede ver en el extremo derecho de la figura \ref{fig:set-up},
los perfiles de intensidad que se usan como entrada para el algoritmo
de la figura \ref{fig:flowchart} corresponden sólo a una pequeña parte
de la imagen en la cual está el orden +1 de la rejilla de
difracción. Dado que los spots tienen un tamaño microscópico, para observar sólo
el orden 1 en el plano de enfoque usamos un objetivo de 
microscopio de magnificación 10x y una cámara CCD marca Imaging
Source.    

En conclusión, para realizar la reconstrucción de fase de un sistema
óptico formador de imagen usando nuestro método, se deben registrar varias de las
imágenes que éste forma cuando se le introducen cambios conocidos en
la fase. Los cambios en la fase se introducen a partir de máscaras de
fase localizadas en uno de sus planos de Fourier por medio de un
TN-SLM.  
Introducir las máscaras de fase genera distorsiones en la distribución
a la salida que además dependen de las aberraciones ópticas desconocidas del
sistema en cuestión. El hecho de generar varias combinaciones de
diversidades y registrar varias imagenes con distorsiones distintas,
lleva a limitar el espacio de soluciones posibles y acerca el método a
una solución única. Esta es la gran ventaja del PD sobre otros métodos
de reconstrucción de fase. 

Adicionalmente, el hecho de usar la familia
de diversidades de espiral, aumenta la sensibilidad del método ante
aberraciones ya que los haces portadores de OAM tienen cambios más
drásticos en sus distribuciones de intensidad cuando hay
aberraciones. Aumentar la sensibilidad tiene un efecto positivo sobre
la exactitud de la solución porque se encuentra de forma más precisa
el valor y tipo de aberraciones que producen una distribución particular. 

El conjunto de imágenes tomadas experimentalmente ($d_j^l$), y las
condiciones particulares con las cuales fueron producidas, tales como:
la forma de la apertura, el tipo de iluminación y la selección de diversidades, son el
argumento de la rutina de PD. En el interior de la rutina de PD,
simulamos el sistema óptico y producimos imágenes artificiales
($|u_j^l|^2$) que son comparadas píxel a píxel con las imágenes
experimentales. Así como las distorsiones en las imágenes
experimentales son función de las aberraciones que desconocemos, las
distorsiones de las imágenes artificiales van a ser función de una
fase conocida y parametrizada ($\phi$) que vamos a variar hasta que el funcional
\ref{eq:metric_coherent_OAMs} retorne un mínimo. 
Cuando acabe el esquema de búsqueda de un mínimo, y la fase
propuesta ($\phi$) produzca imágenes artificiales ($|u_j^l|^2$)
idénticas a las imágenes experimentales, y siempre y cuando las
condiciones de la simulación sean idénticas a las condiciones del
laboratorio, significará que hemos identificado las aberraciones del
sistema óptico correctamente.

Una vez presentado el método, procedemos a presentar los resultados
logrados. 
%introducir un TN-SLM en un plano de Fourier 

\section{Resultados}
\label{sec:ChPD_resultados}

Nuestro método fue probado extensivamente con el fin de validar
nuestras premisas y evaluar su comportamiento ante diversas entradas. 
En esta sección se describen las pruebas simuladas y experimentales
que se realizaron, y se muestran los resultados para cada una. 

\subsection{Resultados de simulaciones}
En primera medida se requería simular el método para corroborar que
funcionaba en sistemas ideales. La simulación de reconstrucción de
fases consiste en reemplazar el conjunto de imagenes de referencia $d_j^l$ por un
conjunto de imágenes artificiales que han sido afectadas por una
aberración conocida inherente al sistema
óptico simulado. La aberración conocida será nuestra fase de
referencia, es decir, la fase con la cual compararemos la exactitud de
la reconstrucción. 
Una vez comprobamos que nuestra implementación del PD reconstruía de
forma precisa aberraciones simples, procedimos a probarlo con
aberraciones generadas aleatoriamente, y luego con aberraciones aleatorias de
diferente magnitud. Asimismo, comparamos el desempeño del PD contra el
método GS con y sin VO, y contra sí mismo con conjuntos diferentes de
diversidades con y sin VO.  

\subsubsection{Preparación de las fases de referencia}

Si las aberraciones se conforman como una combinación lineal de
elementos de la base de Zernike como se muestra en
\ref{eq:ChPD_phase_Zernike}, un frente de onda aleatorio puede ser
facilmente compuesto asignando valores aleatorios a los coeficientes $a_i$. 
\begin{equation}
\label{eq:ChPD_phase_Zernike}
\phi(\vec{u}) = \sum_{i=1}^{N=15}a_iZ_i(\vec{u}). 
\end{equation}
Para generar los coeficientes utilizamos la función \textbf{normrnd}
de Matlab$\circledR$ que produce una lista de números aleatorios pertenecientes
 a una distribución Gaussiana con media y desviación
estándar definidas por el usuario.  En nuestro caso se quería una
misma probabilidad para coeficientes positivos y negativos así que se asignó la media
como $0\lambda$. La desviación estándar se asignó como $0.5\lambda$ como valor
tentativo previo al escalamiento. 

La exactitud de los métodos de reconstrucción de fase en algunos casos
está ligada a la magnitud de las aberraciones. Aberraciones de
magnitud muy pequeña pueden producir resultados similares a
aberraciones de igual magnitud pero distinta forma. Esto es un
problema si los métodos no son lo suficientemente sensibles como para
distinguirlas. Asimismo, aberraciones de magnitudes muy altas pueden
introducir distorsiones tan grandes en las imágenes de entrada que
impiden que los métodos converjan a un mínimo global, o incluso pueden
causar divergencia. Con el fin de evaluar el desempeño de nuestro
PD ante magnitudes variables, generamos aberraciones aleatorias en diferentes
escalas. Se tomó como métrica de la escala el valor de la media
cuadrática (RMS) del frente de onda, que para una base normalizada es:
$$RMS =  \sqrt{\sum_{i=1}^{N=15}a_i^2 }.$$
Los coeficientes aleatorios que entrega la función \textbf{normrnd}
fueron escalados en una rutina de minimización (Referenciar el código)
hasta obtener una combinación con RMS definido. 
Se corrió la rutina de PD para 6 escalas distintas desde $RMS = 1/14\lambda$ (límite de
difracción) hasta $RMS = 1\lambda$. Y cada una de las reconstrucciones
de una escala particular fue repetida con fases distintas 15 veces
para que el resultado fuera estadísticamente significativo. Es decir
que en total se hicieron  90 reconstrucciones de fase por cada método
a evaluar. Se evaluó el método de GS con y sin VO, y el método de PD
de iluminación coherente sin VO, y con VO bajo dos combinaciones
distintas de diversidades haciendo un total de 450 reconstrucciones de
fase.  
Los resultados de estas simulaciones se han condensado en la figura
\ref{fig:ChPD_RMS_error} y se discuten en adelante. 
\begin{figure}[h!]
\centering
\includegraphics[scale=.6]{WF_errors_new_colors_esp.pdf}
\caption[Resultados de simulaciones con PD de iluminación
coherente.]{Las marcas en el eje x denotan el error RMS para
  diferentes escalas con respecto a
  un haz plano para cada conjunto de 15 réplicas. El eje y denota el
  error RMS promedio para entre la aberración de referencia y la
  aberración reconstruída.} 
\label{fig:ChPD_RMS_error}
\end{figure}



\subsection{Resultados experimentales}



\newpage
\pagebreak[4]
\bibliographystyleChPD{unsrtnat}
\bibliographyChPD{References/Ch_PD}

